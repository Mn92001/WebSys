<!DOCTYPE html>
<html lang="en">

<head>
    <title>Pentester Approval</title>
    <?php include "../inc/head.inc.php"; ?>
</head> 

<body>
    <?php include "../inc/header.inc.php"; ?> 

    <?php
    session_start();
   
    include "../inc/navadmin.inc.php";
    include "../processes/approval_of_pentester/query.php";

    // Retrieve and display success message
    if (isset($_SESSION['success'])) {
        $successMsg = $_SESSION['success'];
        unset($_SESSION['success']); 

        echo "<div class='alert alert-success alert-dismissible fade show' role='alert'>" . htmlspecialchars($successMsg) . "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>" . "</div>";
    } 

    // Retrieve and display error messages
    if (isset($_SESSION['error'])) {
        $errorMsg = $_SESSION['error'];
        unset($_SESSION['error']); 
        
        echo "<div class='alert alert-danger' role='alert'>" . htmlspecialchars($errorMsg) . "</div>";
    }
    ?>
     
    <main class="container mt-4">
        <h2>Pentester Approval</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Full Name</th>
                    <th>Resume</th>
                    <th>Certification</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <?php while($row = $result->fetch_assoc()): ?>
                    <tr class="<?php echo $row['ApprovalStatus'] == 'Rejected' || $row['ApprovalStatus'] == 'Suspended' ? 'table-secondary' : ''; ?>">
                        <td><?php echo htmlspecialchars($row['Username']); ?></td>
                        <td><?php echo htmlspecialchars($row['FullName']); ?></td>
                        <td><a href="../processes/approval_of_pentester/download.php?type=resume&id=<?php echo $row['PentesterID']; ?>" class="btn btn-link btn-sm">Download Resume</a></td>
                        <td><a href="../processes/approval_of_pentester/download.php?type=cert&id=<?php echo $row['PentesterID']; ?>" class="btn btn-link btn-sm">Download Certification</a></td>                    
                        <td><?php echo htmlspecialchars($row['ApprovalStatus']); ?></td>
                        <td>
                            <?php if($row['ApprovalStatus'] == 'Pending'): ?>
                                <form action="../processes/approval_of_pentester/approve.php" method="post">
                                    <input type="hidden" name="PentesterID" value="<?php echo $row['PentesterID']; ?>">
                                    <button type="submit" name="status" value="Approved" class="btn btn-success btn-sm">Approve</button>
                                </form>
                                <form action="../processes/approval_of_pentester/reject.php" method="post">
                                    <input type="hidden" name="PentesterID" value="<?php echo $row['PentesterID']; ?>">
                                    <button type="submit" name="status" value="Rejected" class="btn btn-danger btn-sm">Reject</button>
                                </form>
                            <?php elseif($row['ApprovalStatus'] == 'Approved'): ?>
                                <form action="../processes/approval_of_pentester/suspend.php" method="post">
                                    <input type="hidden" name="PentesterID" value="<?php echo $row['PentesterID']; ?>">
                                    <button type="submit" name="status" value="Suspend" class="btn btn-warning btn-sm">Suspend</button>
                                </form>
                            <?php endif; ?>
                        </td>
                    </tr>
                <?php endwhile; ?>
            </tbody>
        </table>
    </main>     
    <?php include "../inc/footer.inc.php"; ?> 
</body> 

</html> 